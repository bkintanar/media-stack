# TRaSH Guides Compliant Media Stack - macOS Testing Version
# Optimized for Apple Silicon (M4 Pro)

services:
  #####################################
  # TORRENT CLIENT
  #####################################
  qbittorrent:
    container_name: qbittorrent
    image: lscr.io/linuxserver/qbittorrent:latest
    restart: unless-stopped
    ports:
      - "8080:8080"
      - "6881:6881"
      - "6881:6881/udp"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Pacific/Auckland
      - WEBUI_PORT=8080
    volumes:
      - ./qbittorrent/config:/config
      - ./data/torrents:/data/torrents  # Relative path
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '2.0'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080"]
      interval: 30s
      timeout: 10s
      retries: 3

  #####################################
  # USENET CLIENT
  #####################################
  sabnzbd:
    image: lscr.io/linuxserver/sabnzbd:latest
    container_name: sabnzbd
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Pacific/Auckland
    volumes:
      - ./sabnzbd/config:/config
      - ./data:/data
    ports:
      - "8081:8080"
    restart: unless-stopped

  #####################################
  # INDEXER MANAGER
  #####################################
  prowlarr:
    container_name: prowlarr
    image: lscr.io/linuxserver/prowlarr:latest
    restart: unless-stopped
    ports:
      - "9696:9696"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Pacific/Auckland
    volumes:
      - ./prowlarr/config:/config
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9696/ping"]
      interval: 30s
      timeout: 10s
      retries: 3

  #####################################
  # MOVIE MANAGEMENT
  #####################################
  radarr:
    container_name: radarr
    image: lscr.io/linuxserver/radarr:latest
    restart: unless-stopped
    ports:
      - "7878:7878"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Pacific/Auckland
    volumes:
      - ./radarr/config:/config
      - ./data:/data  # Relative path - full data access
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '2.0'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7878/ping"]
      interval: 30s
      timeout: 10s
      retries: 3

  #####################################
  # TV SHOW MANAGEMENT
  #####################################
  sonarr:
    container_name: sonarr
    image: lscr.io/linuxserver/sonarr:latest
    restart: unless-stopped
    ports:
      - "8989:8989"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Pacific/Auckland
    volumes:
      - ./sonarr/config:/config
      - ./data:/data  # Relative path - full data access
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '2.0'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8989/ping"]
      interval: 30s
      timeout: 10s
      retries: 3

  #####################################
  # SUBTITLE MANAGEMENT
  #####################################
  bazarr:
    container_name: bazarr
    image: lscr.io/linuxserver/bazarr:latest
    restart: unless-stopped
    ports:
      - "6767:6767"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Pacific/Auckland
    volumes:
      - ./bazarr/config:/config
      - ./data/media:/data/media  # Relative path
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6767"]
      interval: 30s
      timeout: 10s
      retries: 3

  #####################################
  # MEDIA SERVER
  #####################################
  jellyfin:
    container_name: jellyfin
    image: jellyfin/jellyfin:latest
    restart: unless-stopped
    ports:
      - "8096:8096"
      - "8920:8920"
      - "7359:7359/udp"
      - "1900:1900/udp"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Pacific/Auckland
    volumes:
      - ./jellyfin/config:/config
      - ./jellyfin/cache:/cache
      - ./data/media:/data/media:ro  # Relative path
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '2.0'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8096/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  #####################################
  # TRASH GUIDES AUTO-SYNC
  #####################################
  recyclarr:
    container_name: recyclarr
    image: ghcr.io/recyclarr/recyclarr:latest
    restart: unless-stopped
    environment:
      - TZ=Pacific/Auckland
      - CRON_SCHEDULE=@daily
    volumes:
      - ./recyclarr/config:/config
    user: "1000:1000"
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'

  #####################################
  # FLARESOLVERR (CloudFlare Bypass)
  #####################################
  flaresolverr:
    container_name: flaresolverr
    image: ghcr.io/flaresolverr/flaresolverr:latest
    restart: unless-stopped
    ports:
      - "8191:8191"
    environment:
      - LOG_LEVEL=info
      - LOG_HTML=false
      - CAPTCHA_SOLVER=none
      - TZ=Pacific/Auckland
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'


networks:
  default:
    driver: bridge
